<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/image/logo.png" type="image/x-icon">
    <title>이벤터</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/common/frame.css"/>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="/css/user/me.css"/>
</head>

<body>

<header th:insert="~{common/header}"></header>

<div class="wrapper">
    <div class="main-content">
        <div class="body-container">
            <section id="page">
                <section id="page-menu-container" th:insert="~{common/admin-menu.html}"></section>
                <section id="page-content">
                    <section id="page-header">
                        <h5>회원 정보 수정</h5>
                    </section>

                    <hr style="width: 100%"/>

                    <div class="container my-page-container">

                        <div class="card mb-4">
                            <div class="card-header">
                                <h6>회원 특성 수정</h6>
                            </div>
                            <div class="card-body">
                                <form id="attributeForm" th:action="@{/users/{userId}/attribute (userId=${userId})}"
                                      th:method="put">
                                    <div class="form-group" style="width: 300px">
                                        <label for="statusId">회원 상태</label>
                                        <select class="form-control" id="statusId" name="statusId" required>
                                            <option value="" disabled selected>상태를 선택하세요</option>
                                            <option th:each="status : ${statuses}"
                                                    th:value="${status.statusId}"
                                                    th:text="${status.name}"
                                                    th:selected="${status.name == user.statusName}">
                                            </option>
                                        </select>
                                    </div>

                                    <div class="form-group" style="width: 300px">
                                        <label for="gradeId">회원 등급</label>
                                        <select class="form-control" id="gradeId" name="gradeId" required>
                                            <option value="" disabled selected>등급을 선택하세요</option>
                                            <option th:each="grade : ${grades}"
                                                    th:value="${grade.gradeId}"
                                                    th:text="${grade.name}"
                                                    th:selected="${grade.name == user.gradeName}">
                                            </option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <button type="submit" id="updateButton" class="btn btn-primary">수정</button>
                                        <a th:href="@{/users/{userId} (userId=${userId})}"
                                           class="btn btn-secondary">뒤로가기</a>
                                    </div>
                                </form>


                                <hr style="width: 100%"/>

                                <div class="form-group" style="width: 300px">
                                    <form th:action="@{/users/{userId}/roles (userId=${userId})}" th:method="post">
                                        <label for="roleId">회원 권한</label>
                                        <div style="display: flex; align-items: center;">
                                            <select class="form-control" id="roleId" name="roleId" required>
                                                <option value="">추가할 권한 선택</option>
                                                <option th:each="role : ${unassignedRoles}"
                                                        th:value="${role.roleId}"
                                                        th:text="${role.name}"
                                                        th:selected="${role.name == user.statusName}">
                                                </option>
                                            </select>
                                            <button class="btn btn-primary">권한 추가</button>
                                        </div>
                                    </form>

                                    <table class="table-bordered" style="width: 300px">
                                        <thead>
                                        <tr class="inline-text">
                                            <th>권한</th>
                                            <th style="width: 50px"></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="role : ${userRoles}">
                                            <td th:text="${role.name}">권한</td>
                                            <td style="display: flex; justify-content: center; align-items: center; width: 50px;">
                                                <!-- 너비를 버튼에 맞게 설정 -->
                                                <form th:action="@{/users/{userId}/roles/{roleId} (userId=${userId}, roleId=${role.roleId})}"
                                                      th:method="delete">
                                                    <button type="submit" class="btn btn-sm btn-danger inline-text">
                                                        삭제
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>

                                </div>

                            </div>
                        </div>

                    </div>
                </section>
            </section>
        </div>
    </div>
</div>

<footer th:insert="~{common/footer}"></footer>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>
