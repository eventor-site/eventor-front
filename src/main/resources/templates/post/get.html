<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/fragments/defaultLayout}"
      lang="ko">
<head>
    <th:block th:replace="~{common/fragments/config}"></th:block>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/post/get.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/post/hotDeal.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/comment/list.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/common/highlight.css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* ì²¨ë¶€íŒŒì¼ í…ìŠ¤íŠ¸ì˜ hover íš¨ê³¼ */
        .attachment-text {
            cursor: pointer;
            font-weight: bold;
            transition: color 0.3s ease;
        }

        /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ìƒ‰ìƒì´ ë³€ê²½ë˜ë„ë¡ */
        .attachment-text:hover {
            color: #007bff; /* ì›í•˜ëŠ” hover ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½ */
        }

    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="body-container">
        <h5>ì¹´í…Œê³ ë¦¬: <span id="categoryName" th:data-category-name="${post.categoryName}"
                        th:text="${post.categoryName}"></span></h5>

        <div class="post-header">
            <!-- ì´ë²¤íŠ¸ ì‹œê°„ ë° ë‚¨ì€ ì‹œê°„ -->
            <div class="event-time"
                 th:if="${post.categoryName != 'ììœ ' and post.categoryName != 'ê³µì§€' and post.categoryName != 'ë§›ì§‘' and post.categoryName != 'í•«ë”œ'}">
                <div class="left">
                    <span class="label">ì´ë²¤íŠ¸ ì‹œì‘ ì‹œê°„:</span>
                    <span th:text="${#temporals.format(post.startTime, 'yyyy-MM-dd HH:mm')}"></span>
                </div>
                <div class="left">
                    <span class="label">ì´ë²¤íŠ¸ ì¢…ë£Œ ì‹œê°„:</span>
                    <span id="endTime"
                          th:data-end-time="${post.endTime != null ? post.endTime : ''}"
                          th:text="${post.endTime != null ? #temporals.format(post.endTime, 'yyyy-MM-dd HH:mm') : 'ë³„ë„ ê³µì§€ì‹œ'}">
                    </span>
                </div>
                <div class="right">
                    <span class="label">ë‚¨ì€ ì‹œê°„:</span>
                    <span id="remainingTime" class="remaining-time">ê³„ì‚°ì¤‘...</span>
                </div>
            </div>

            <hr style="width: 100%"
                th:if="${post.categoryName != 'ììœ ' and post.categoryName != 'ê³µì§€' and post.categoryName != 'ë§›ì§‘' and post.categoryName != 'í•«ë”œ'}"/>

            <!-- ì œëª© ë° ì‘ì„±ì‹œê°„ -->
            <div class="title-section">
                <div th:text="${post.title}"></div>
            </div>

            <hr>

            <!-- ì‘ì„±ì ë° ì¡°íšŒìˆ˜, ì¶”ì²œìˆ˜ -->
            <div class="author-section">
                <div class="left">
                    <img class="grade" th:src="@{/profile/{gradeName}.png (gradeName=${post.writerGrade})}"
                         alt="í”„ë¡œí•„">
                    <p><strong class="label">ì‘ì„±ì:</strong> <span th:text="${post.writer()}"></span></p>
                </div>
                <div class="right">
                    <p><strong class="label">ì¡°íšŒìˆ˜:</strong> <span th:text="${post.viewCount}"></span></p>
                    <p><strong class="label">ì¶”ì²œìˆ˜:</strong> <span th:text="${post.recommendationCount}"></span></p>
                    <p><strong class="label">ëŒ“ê¸€ìˆ˜:</strong> <span th:text="${objects.getTotalElements()}"></span></p>
                    <p><strong class="label">ì‘ì„±ì‹œê°„:</strong><span
                            th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                </div>
            </div>
        </div>

        <div th:if="${post.categoryName != 'ììœ ' and post.categoryName != 'ê³µì§€' and post.categoryName != 'ë§›ì§‘' and post.categoryName != 'í•«ë”œ'}">
            <table class="table">
                <tbody>
                <tr>
                    <th>ë§í¬</th>
                    <td><a th:href="${post.link}" th:text="${post.link}" target="_blank"></a></td>
                </tr>
                </tbody>
            </table>
        </div>

        <div th:if="${post.categoryName == 'í•«ë”œ'}">
            <table class="table">
                <tbody>
                <tr>
                    <th>ë§í¬</th>
                    <td><a th:href="${post.link}" th:text="${post.link}" target="_blank"></a></td>
                </tr>
                <tr>
                    <th>ì‡¼í•‘ëª°</th>
                    <td th:text="${post.shoppingMall}"></td>
                </tr>
                <tr>
                    <th>ìƒí’ˆëª…</th>
                    <td th:text="${post.productName}"></td>
                </tr>
                <tr>
                    <th>ê°€ê²©</th>
                    <td th:text="${post.price}"></td>
                </tr>
                </tbody>
            </table>
        </div>


        <!-- ê²Œì‹œê¸€ ë‚´ìš© ëª¸í†µ -->
        <div class="post-body">

            <!-- ì´ë¯¸ì§€ ì¶œë ¥ -->
            <div class="image-gallery"
                 th:classappend="${isEvent ? 'event-gallery' : ''}">
                <div th:each="image : ${post.images}" th:if="${!image.isThumbnail and !image.isPasted}"
                     class="image-container">
                    <!-- ì´ë¯¸ì§€ -->
                    <img th:src="${image.url}" alt="ì´ë¯¸ì§€"/>
                </div>
            </div>

            <p th:utext="${post.content}"></p>
        </div>

        <div class="post-recommend-container">
            <button class="btn btn-sm btn-outline-primary"
                    th:data-url="@{/posts/{postId}/recommend (postId=${post.postId})}"
                    data-method="PUT"
                    onclick="setupAlertBox(this)">ì¶”ì²œ
            </button>

            <button class="btn btn-sm btn-outline-primary"
                    th:data-url="@{/posts/{postId}/disrecommend (postId=${post.postId})}"
                    data-method="PUT"
                    onclick="setupAlertBox(this)">ë¹„ì¶”ì²œ
            </button>

            <!-- ì¢‹ì•„ìš” -->
            <button class="btn btn-sm btn-outline-primary"
                    th:data-url="@{/posts/{postId}/favorites (postId=${post.postId})}"
                    data-method="Post"
                    onclick="favorite(this)">
                <i id="favoriteIcon" class="fa-solid fa-heart"
                   th:style="${post.isFavorite} ? 'color: red' : 'color: grey'"></i>
            </button>

            <button class="btn btn-sm btn-outline-primary report-button"
                    th:data-url="@{/posts/{postId}/postReports (postId=${post.postId})}"
                    data-method="POST">
                ğŸš¨
            </button>
            <div class="popup report-popup">
                <p><strong>[ì‹ ê³ ìœ í˜•]</strong></p>
                <a data-report-type="í­ì–¸" onclick="submitReport(this)">- í­ì–¸</a>
                <a data-report-type="ì •ì¹˜" onclick="submitReport(this)">- ì •ì¹˜</a>
                <a data-report-type="ì„±ì¸ë¬¼" onclick="submitReport(this)">- ì„±ì¸ë¬¼</a>
                <a data-report-type="ê¸°íƒ€" onclick="submitReport(this)">- ê¸°íƒ€</a>
            </div>

            <a class="btn-sm btn-secondary" onclick="history.back()">ë’¤ë¡œê°€ê¸°</a>

            <div th:if="${post.isAuthorized}" style="display: flex; align-items: center;">
                <a th:href="@{/posts/{postId}/updateForm (postId=${post.postId()})}"
                   class="btn btn-sm btn-warning inline-text">ìˆ˜ì •
                </a>
                <form th:action="@{/posts/{postId} (postId=${post.postId()}, categoryName=${post.categoryName})}"
                      th:method="delete">
                    <button type="submit" class="btn btn-sm btn-danger inline-text">ì‚­ì œ</button>
                </form>
            </div>
        </div>

        <!-- ì²¨ë¶€íŒŒì¼ -->
        <div th:if="${!post.images().isEmpty()}" class="image-gallery"
             style="display: flex; flex-wrap: wrap; gap: 10px;">
            <hr>
            <!-- ì²¨ë¶€íŒŒì¼ ê°œìˆ˜ ì¶œë ¥ ë° í´ë¦­ ì‹œ ë§í¬ í† ê¸€ -->
            <div class="attachment-text" onclick="toggleImageLinks()" style="cursor: pointer;">
                ì²¨ë¶€íŒŒì¼ <span th:text="${#lists.size(post.images)}"></span> ê°œ
            </div>

            <!-- ì´ë¯¸ì§€ ë§í¬ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬) -->
            <div id="image-links" style="display: none; flex-wrap: wrap; gap: 10px;">
                <div th:each="image : ${post.images}" th:if="${!image.isThumbnail and !image.isPasted}">
                    <a th:href="${image.url}" th:text="${image.originalName}"></a>
                </div>
            </div>
        </div>


        <hr>

        <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
        <div class="comment-section">
            <h5>ëŒ“ê¸€ <span th:text="${objects.getTotalElements()}"></span> ê°œ</h5>

            <hr>

            <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
            <div th:each="comment : ${objects}" th:class="'depth-' + ${comment.depth}"
                 th:style="'margin-left: ' + ${comment.depth * 20} + 'px'"
                 th:id="${comment.commentId}">
                <div class="comment-container" th:id="${comment.commentId}">
                    <div>
                        <img class="grade"
                             th:src="@{/profile/{gradeName}.png (gradeName=${comment.writerGrade})}"
                             alt="í”„ë¡œí•„">
                        <strong th:text="${comment.writer}"></strong>
                        <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                    </div>
                    <div class="comment-recommend-container">
                        <button class="btn btn-sm btn-outline-primary"
                                th:data-url="@{/posts/{postId}/comments/{commentId}/recommend (postId=${post.postId}, commentId=${comment.commentId})}"
                                data-method="PUT"
                                onclick="setupAlertBox(this)">ì¶”ì²œ
                        </button>
                        <span th:text="${comment.recommendationCount}"></span>

                        <button class="btn btn-sm btn-outline-primary"
                                th:data-url="@{/posts/{postId}/comments/{commentId}/disrecommend (postId=${post.postId}, commentId=${comment.commentId})}"
                                data-method="PUT"
                                onclick="setupAlertBox(this)">ë¹„ì¶”ì²œ
                        </button>
                        <span th:text="${comment.decommendationCount}"></span>

                        <!-- ëŒ€ëŒ“ê¸€ ì‘ì„± ë²„íŠ¼ -->
                        <button class="btn btn-sm btn-outline-primary">ëŒ€ëŒ“ê¸€ ì‘ì„±</button>

                        <button class="btn btn-sm btn-outline-primary report-button"
                                th:data-url="@{/comments/{commentId}/commentReports (commentId=${comment.commentId})}"
                                data-method="POST">
                            ğŸš¨
                        </button>
                        <div class="popup report-popup">
                            <p><strong>[ì‹ ê³ ìœ í˜•]</strong></p>
                            <a data-report-type="ì •ì¹˜" onclick="submitReport(this)">- ì •ì¹˜</a>
                            <a data-report-type="ì„±ì¸ë¬¼" onclick="submitReport(this)">- ì„±ì¸ë¬¼</a>
                            <a data-report-type="ê¸°íƒ€" onclick="submitReport(this)">- ê¸°íƒ€</a>
                        </div>

                        <div th:if="${comment.isAuthorized and comment.content != '[ì‚­ì œëœ ëŒ“ê¸€ì…ë‹ˆë‹¤.]'}"
                             style="display: flex; align-items: center;">
                            <button type="button" class="btn btn-sm btn-warning inline-text">ìˆ˜ì •</button>
                            <form th:action="@{/posts/{postId}/comments/{commentId} (postId=${post.postId}, commentId=${comment.commentId})}"
                                  th:method="delete">
                                <button type="submit" class="btn btn-sm btn-danger inline-text">ì‚­ì œ</button>
                            </form>
                        </div>
                    </div>

                    <div class="comment" th:text="${comment.content}"></div>

                    <div class="sub-comment-form-container"
                         th:data-post-id="${post.postId}"
                         th:data-comment-id="${comment.commentId}"></div>
                </div>

                <hr>

            </div>

            <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
            <div class="comment-form-container" th:data-post-id="${post.postId}"></div>
        </div>

        <!-- í˜ì´ì§• ì²˜ë¦¬ ì‹œì‘-->
        <div th:insert="~{common/paging.html}"></div>
        <!-- í˜ì´ì§• ì²˜ë¦¬ ë-->

    </div>
</div>

<th:block layout:fragment="script">
    <script src="/js/post/comment.js"></script>
    <script src="/js/post/sub-comment.js"></script>
    <script src="/js/post/remainingTime.js"></script>
    <script src="/js/post/report.js"></script>
    <script src="/js/common/highlight.js"></script>
    <script src="/js/post/favorite.js"></script>
    <script>
        function toggleImageLinks() {
            var imageLinksDiv = document.getElementById('image-links');
            var currentDisplay = imageLinksDiv.style.display;

            // ì´ë¯¸ì§€ ë§í¬ ì˜ì—­ì˜ í‘œì‹œ/ìˆ¨ê¹€ ìƒíƒœë¥¼ í† ê¸€
            if (currentDisplay === 'none' || currentDisplay === '') {
                imageLinksDiv.style.display = 'flex';  // ë§í¬ë¥¼ ë³´ì—¬ì¤Œ
            } else {
                imageLinksDiv.style.display = 'none';  // ë§í¬ë¥¼ ìˆ¨ê¹€
            }
        }

    </script>
</th:block>
</body>
</html>
