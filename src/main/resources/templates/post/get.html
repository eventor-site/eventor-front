<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/fragments/defaultLayout}"
      lang="ko">
<head>
    <th:block th:replace="~{common/fragments/config}"></th:block>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/post/get.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/post/table.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/comment/list.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/common/highlight.css"/>
</head>

<body>
<div layout:fragment="content">
    <div id="postDetailView" class="body-container">
        <div class="d-flex justify-content-between align-items-center">
            <h5>
                Ïπ¥ÌÖåÍ≥†Î¶¨:
                <a id="categoryName"
                   th:data-category-name="${post.categoryName}"
                   th:text="${post.categoryName}"
                   th:href="@{/posts (categoryName=${post.categoryName})}">
                </a>
            </h5>

            <div id="thumbnailUrl" th:text="${thumbnailUrl}" hidden></div>

            <div class="d-flex align-items-center mb-2 gap-2" th:if="${post.isAuthorized}">
                <form th:if="${isEvent}"
                      th:action="@{/posts/{postId}/finish (postId=${post.postId})}"
                      th:method="put">
                    <button type="submit" class="btn btn-secondary">Ï¢ÖÎ£å</button>
                </form>
                <a th:href="@{/posts/{postId}/updateForm (postId=${post.postId})}"
                   class="btn btn-warning inline-text">ÏàòÏ†ï
                </a>
                <form th:action="@{/posts/{postId} (postId=${post.postId()}, categoryName=${post.categoryName})}"
                      th:method="delete">
                    <button type="submit" class="btn btn-danger">ÏÇ≠Ï†ú</button>
                </form>
            </div>

        </div>
        <div class="post-header">
            <!-- Ïù¥Î≤§Ìä∏ ÏãúÍ∞Ñ Î∞è ÎÇ®ÏùÄ ÏãúÍ∞Ñ -->
            <div class="event-time"
                 th:if="${isEvent}">

                <div class="left">
                    <span class="label">
                        Í∏∞Í∞Ñ:
                        <span th:text="${#temporals.format(post.startTime, 'yyyy-MM-dd HH:mm')}"></span>
                        ~
                        <span id="endTime" th:data-end-time="${post.endTime != null ? post.endTime : ''}"
                              th:text="${post.endTime != null ? #temporals.format(post.endTime, 'yyyy-MM-dd HH:mm') : 'Î≥ÑÎèÑ Í≥µÏßÄÏãú'}"></span>
                    </span>
                </div>

                <div class="right">
                    <span class="label">ÎÇ®ÏùÄ ÏãúÍ∞Ñ: <span id="remainingTime" class="remaining-time">Í≥ÑÏÇ∞Ï§ë...</span></span>
                </div>
            </div>

            <hr th:if="${isEvent}"/>

            <!-- Ï†úÎ™© Î∞è ÏûëÏÑ±ÏãúÍ∞Ñ -->
            <div class="title-section">
                <strong id="postTitle" th:text="${post.title}"></strong>
            </div>

            <hr>

            <!-- ÏûëÏÑ±Ïûê Î∞è Ï°∞ÌöåÏàò, Ï∂îÏ≤úÏàò -->
            <div class="author-section">
                <div class="left">
                    <img class="grade" th:src="@{/profile/{gradeName}.png (gradeName=${post.writerGrade})}"
                         alt="ÌîÑÎ°úÌïÑ">
                    <strong th:text="${post.writer}"></strong>
                </div>
                <div class="right">
                    <p><strong class="label">Ï°∞ÌöåÏàò</strong><span th:text="${post.viewCount}"></span></p>
                    <p><strong class="label">Ï∂îÏ≤ú</strong><span th:text="${post.recommendationCount}"></span></p>
                    <p><strong class="label">ÎåìÍ∏Ä</strong><span th:text="${objects.getTotalElements()}"></span></p>
                    <p><strong class="label"></strong><span
                            th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                </div>
            </div>
        </div>

        <div th:if="${isEvent}">
            <table class="table">
                <tbody>
                <tr>
                    <th>ÎßÅÌÅ¨</th>
                    <td><a th:href="${post.link}" th:text="${post.link}" target="_blank"></a></td>
                </tr>
                </tbody>
            </table>
        </div>

        <!--        <div class="share-buttons">-->
        <!--            &lt;!&ndash; X &ndash;&gt;-->
        <!--            <a id="btnTwitter" class="link-icon x" href="javascript:shareX();"></a>-->

        <!--            &lt;!&ndash; Facebook &ndash;&gt;-->
        <!--            <a id="btnFacebook" class="link-icon facebook" href="javascript:shareFacebook();"></a>-->

        <!--            &lt;!&ndash; KakaoTalk &ndash;&gt;-->
        <!--            <a id="btnKakao" class="link-icon kakao" href="javascript:shareKakao();"></a>-->

        <!--            <button class="link-icon"><i class="fa-regular fa-paste"></i></button>-->
        <!--        </div>-->

        <!--        <button class="link-icon"><i class="fa-solid fa-share-nodes"></i></button>-->


        <div th:if="${post.categoryName == 'Ìï´Îîú'}">
            <table class="table">
                <tbody>
                <tr>
                    <th>ÎßÅÌÅ¨</th>
                    <td><a th:href="${post.link}" th:text="${post.link}" target="_blank"></a></td>
                </tr>
                <tr>
                    <th>ÏáºÌïëÎ™∞</th>
                    <td th:text="${post.shoppingMall}"></td>
                </tr>
                <tr>
                    <th>ÏÉÅÌíàÎ™Ö</th>
                    <td th:text="${post.productName}"></td>
                </tr>
                <tr>
                    <th>Í∞ÄÍ≤©</th>
                    <td th:text="${post.price}"></td>
                </tr>
                </tbody>
            </table>
        </div>


        <!-- Í≤åÏãúÍ∏Ä ÎÇ¥Ïö© Î™∏ÌÜµ -->
        <div class="post-body">

            <!-- Ïù¥ÎØ∏ÏßÄ Î∞è ÎèôÏòÅÏÉÅ Ï∂úÎ†• -->
            <div class="image-gallery" th:if="${isEvent}" th:classappend="${isEvent ? 'event-gallery' : ''}">
                <div th:each="image : ${post.images}" th:if="${!image.isThumbnail and !image.isPasted}"
                     class="image-container">
                    <img th:if="${image.type == 'image'}" th:src="${image.url}" alt="Ïù¥ÎØ∏ÏßÄ"/>
                    <video th:if="${image.type == 'video'}" th:src="${image.url}" controls>
                        Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÎπÑÎîîÏò§ ÌÉúÍ∑∏Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
                    </video>
                </div>
            </div>

            <div class="image-gallery" th:unless="${isEvent}" th:classappend="${isEvent ? 'event-gallery' : ''}">
                <div th:each="image : ${post.images}" th:if="${!image.isPasted}"
                     class="image-container">
                    <img th:if="${image.type == 'image'}" th:src="${image.url}" alt="Ïù¥ÎØ∏ÏßÄ"/>
                    <video th:if="${image.type == 'video'}" th:src="${image.url}" controls>
                        Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÎπÑÎîîÏò§ ÌÉúÍ∑∏Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.
                    </video>
                </div>
            </div>

            <p id="postContent" th:utext="${post.content}"></p>
        </div>

        <div class="post-recommend-container">
            <img class="btn btn-sm btn-outline-primary recommend-button-img"
                 th:data-url="@{/posts/{postId}/recommend (postId=${post.postId})}"
                 data-method="PUT"
                 onclick="setupAlertBox(this)"
                 src="/image/comment/recommend.svg" alt="Ï∂îÏ≤ú">

            <img class="btn btn-sm btn-outline-primary recommend-button-img"
                 th:data-url="@{/posts/{postId}/disrecommend (postId=${post.postId})}"
                 data-method="PUT"
                 onclick="setupAlertBox(this)"
                 src="/image/comment/disrecommend.svg" alt="ÎπÑÏ∂îÏ≤ú">


            <!-- Ï¢ãÏïÑÏöî -->
            <button class="btn btn-sm btn-outline-primary"
                    th:data-url="@{/posts/{postId}/favorites (postId=${post.postId})}"
                    data-method="Post"
                    onclick="favorite(this)">
                <i id="favoriteIcon" class="fa-solid fa-heart"
                   th:style="${post.isFavorite} ? 'color: red' : 'color: grey'"></i>
            </button>

            <button class="btn btn-sm btn-outline-primary report-button"
                    th:data-url="@{/posts/{postId}/postReports (postId=${post.postId})}"
                    data-method="POST">
                üö®
            </button>
            <div class="popup report-popup">
                <p><strong>[Ïã†Í≥†Ïú†Ìòï]</strong></p>
                <a data-report-type="Ìè≠Ïñ∏" onclick="submitReport(this)">- Ìè≠Ïñ∏</a>
                <a data-report-type="Ï†ïÏπò" onclick="submitReport(this)">- Ï†ïÏπò</a>
                <a data-report-type="ÏÑ±Ïù∏Î¨º" onclick="submitReport(this)">- ÏÑ±Ïù∏Î¨º</a>
                <a data-report-type="Í∏∞ÌÉÄ" onclick="submitReport(this)">- Í∏∞ÌÉÄ</a>
            </div>

            <a class="btn btn-sm btn-secondary" onclick="history.back()">Îí§Î°úÍ∞ÄÍ∏∞</a>

        </div>

        <!-- Ï≤®Î∂ÄÌååÏùº -->
        <div th:if="${post.attachmentImageCount > 0}" class="image-gallery"
             style="display: flex; flex-wrap: wrap; gap: 10px;">
            <hr>
            <!-- Ï≤®Î∂ÄÌååÏùº Í∞úÏàò Ï∂úÎ†• Î∞è ÌÅ¥Î¶≠ Ïãú ÎßÅÌÅ¨ ÌÜ†Í∏Ä -->
            <div class="attachment-text" onclick="toggleImageLinks()" style="cursor: pointer;">
                Ï≤®Î∂ÄÌååÏùº <span th:text="${post.attachmentImageCount}"></span> Í∞ú
            </div>

            <!-- Ïù¥ÎØ∏ÏßÄ ÎßÅÌÅ¨ ÏòÅÏó≠ (Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Ïà®ÍπÄ Ï≤òÎ¶¨) -->
            <div id="image-links" style="display: none; flex-wrap: wrap; gap: 10px;">
                <div th:each="image : ${post.images}">
                    <a th:href="${image.url}" th:text="${image.originalName}"></a>
                </div>
            </div>
        </div>


        <hr>

        <!-- ÎåìÍ∏Ä ÏÑπÏÖò -->
        <div class="comment-section">
            <h5>ÎåìÍ∏Ä <span th:text="${objects.getTotalElements()}"></span> Í∞ú</h5>

            <hr>

            <!-- ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏ -->
            <div th:each="comment : ${objects}" th:class="'depth-' + ${comment.depth}"
                 th:style="'margin-left: ' + ${comment.depth * 20} + 'px'"
                 th:id="${comment.commentId}">
                <div class="d-flex flex-column gap-2">
                    <div class="comment-container d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2"
                         th:id="${comment.commentId}">
                        <div>
                            <span th:if="${comment.depth >= 1}">„Ñ¥</span>
                            <img class="grade"
                                 th:src="@{/profile/{gradeName}.png (gradeName=${comment.writerGrade})}"
                                 alt="ÌîÑÎ°úÌïÑ">
                            <strong class="me-3" th:text="${comment.writer}"></strong>
                            <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                        </div>
                        <div class="comment-function-container">
                            <img class="btn btn-sm btn-outline-primary recommend-button-img"
                                 th:data-url="@{/comments/{commentId}/recommend (commentId=${comment.commentId})}"
                                 data-method="PUT"
                                 onclick="setupAlertBox(this)"
                                 src="/image/comment/recommend.svg" alt="Ï∂îÏ≤ú">

                            <span th:text="${comment.recommendationCount}"></span>

                            <img class="btn btn-sm btn-outline-primary recommend-button-img"
                                 th:data-url="@{/comments/{commentId}/disrecommend (commentId=${comment.commentId})}"
                                 data-method="PUT"
                                 onclick="setupAlertBox(this)"
                                 src="/image/comment/disrecommend.svg" alt="ÎπÑÏ∂îÏ≤ú">

                            <span th:text="${comment.decommendationCount}"></span>

                            <!-- ÎåÄÎåìÍ∏Ä ÏûëÏÑ± Î≤ÑÌäº -->
                            <button class="btn btn-sm btn-outline-primary">ÎåÄÎåìÍ∏Ä ÏûëÏÑ±</button>

                            <button class="btn btn-sm btn-outline-primary report-button"
                                    th:data-url="@{/comments/{commentId}/commentReports (commentId=${comment.commentId})}"
                                    data-method="POST">
                                üö®
                            </button>
                            <div class="popup report-popup">
                                <p><strong>[Ïã†Í≥†Ïú†Ìòï]</strong></p>
                                <a data-report-type="Ï†ïÏπò" onclick="submitReport(this)">- Ï†ïÏπò</a>
                                <a data-report-type="ÏÑ±Ïù∏Î¨º" onclick="submitReport(this)">- ÏÑ±Ïù∏Î¨º</a>
                                <a data-report-type="Í∏∞ÌÉÄ" onclick="submitReport(this)">- Í∏∞ÌÉÄ</a>
                            </div>

                            <div th:if="${comment.isAuthorized and comment.deletedAt == null}"
                                 class="d-flex align-items-center">
                                <button type="button" class="btn btn-sm btn-warning inline-text">ÏàòÏ†ï</button>
                                <form th:action="@{/posts/{postId}/comments/{commentId} (postId=${post.postId}, commentId=${comment.commentId})}"
                                      th:method="delete">
                                    <button type="submit" class="btn btn-sm btn-danger inline-text">ÏÇ≠Ï†ú</button>
                                </form>
                            </div>
                        </div>

                    </div>

                    <div class="d-inline">
                        <span class="parent-writer text-muted me-2" th:text="${comment.parentWriter}"></span>
                        <span class="comment" th:text="${comment.content}"></span>
                    </div>

                    <div class="sub-comment-form-container"
                         th:data-post-id="${post.postId}"
                         th:data-comment-id="${comment.commentId}"></div>

                </div>

                <hr>

            </div>

            <!-- ÎåìÍ∏Ä ÏûëÏÑ± Ìèº -->
            <div class="comment-form-container" th:data-post-id="${post.postId}"></div>
        </div>

        <!-- ÌéòÏù¥Ïßï Ï≤òÎ¶¨ ÏãúÏûë-->
        <div th:insert="~{common/paging.html}"></div>
        <!-- ÌéòÏù¥Ïßï Ï≤òÎ¶¨ ÎÅù-->

    </div>
</div>

<th:block layout:fragment="script">
    <script src="/js/post/comment.js"></script>
    <script src="/js/post/sub-comment.js"></script>
    <script src="/js/post/remainingTime.js"></script>
    <script src="/js/post/report.js"></script>
    <script src="/js/common/highlight.js"></script>
    <script src="/js/post/favorite.js"></script>
    <script src="/js/post/toggleImageLinks.js"></script>
    <script src="/js/post/video.js"></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script th:inline="javascript" src="/js/post/share-button.js"></script>
</th:block>
</body>
</html>
