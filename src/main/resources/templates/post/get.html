<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/image/logo.png" type="image/x-icon">
    <title>Ïù¥Î≤§ÌÑ∞</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/common/frame.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="/css/post/get.css"/>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>

<body>

<header th:insert="~{common/header}"></header>

<div class="wrapper">
    <div class="main-content">
        <div class="top-container2">
            <h5>Ïπ¥ÌÖåÍ≥†Î¶¨: <span th:text="${post.categoryName}"></span></h5>
            <hr style="width: 100%"/>

            <div th:if="${post.categoryName} == 'Ïù¥Î≤§Ìä∏'" class="post-header d-flex align-items-center">
                <div class="left">
                    <span style="margin-right: 10px; font-weight: bold;">Ïù¥Î≤§Ìä∏ ÏãúÏûë ÏãúÍ∞Ñ:</span>
                    <span th:text="${#temporals.format(post.startTime, 'yyyy-MM-dd HH:mm')}"
                          style="margin-right: 20px;"></span>

                    <span style="margin-right: 10px; font-weight: bold;">Ïù¥Î≤§Ìä∏ Ï¢ÖÎ£å ÏãúÍ∞Ñ:</span>
                    <span th:text="${#temporals.format(post.endTime, 'yyyy-MM-dd HH:mm')}"
                          style="margin-right: 20px;" id="endTime" th:data-end-time="${post.endTime}"></span>

                </div>
                <div class="right">
                    <span style="margin-right: 10px; font-weight: bold;">ÎÇ®ÏùÄ ÏãúÍ∞Ñ:</span>
                    <span id="remainingTime" style="font-weight: bold; color: red;">Í≥ÑÏÇ∞ Ï§ë...</span>
                </div>
            </div>


            <!-- Ï≤´ Î≤àÏß∏ Ï§Ñ: Ï†úÎ™© ÏôºÏ™Ω, ÏûëÏÑ±Ïûê Ïò§Î•∏Ï™Ω -->
            <div class="post-header">
                <div class="left">
                    <p><strong>Ï†úÎ™©:</strong> <span th:text="${post.title}"></span></p>
                </div>
                <div class="right">
                    <img class="userGrade"
                         th:src="@{/profile/{userGradeName}.png (userGradeName=${post.userGradeName()})}"
                         alt="ÌîÑÎ°úÌïÑ">
                    <p><strong>ÏûëÏÑ±Ïûê:</strong> <span th:text="${post.writer()}"></span></p>
                </div>
            </div>

            <!-- Îëê Î≤àÏß∏ Ï§Ñ: Ï°∞ÌöåÏàòÏôÄ Ï∂îÏ≤úÏàò ÏôºÏ™Ω, ÏûëÏÑ±ÏãúÍ∞Ñ Ïò§Î•∏Ï™Ω -->
            <div class="post-header">
                <div class="left">
                    <p><strong>Ï°∞ÌöåÏàò:</strong> <span th:text="${post.viewCount}"></span></p>
                    <p><strong>Ï∂îÏ≤úÏàò:</strong> <span th:text="${post.recommendationCount}"></span></p>
                </div>
                <div class="right">
                    <p><strong>ÏûëÏÑ±ÏãúÍ∞Ñ:</strong> <span
                            th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span></p>
                </div>
            </div>

            <hr style="width: 100%"/>

            <!-- Ïù¥ÎØ∏ÏßÄ Ï∂úÎ†• -->
            <div class="image-gallery">
                <div th:each="image : ${post.images}" class="image-container">
                    <!-- Ïù¥ÎØ∏ÏßÄ -->
                    <img th:src="${image.url}" alt="Ïù¥ÎØ∏ÏßÄ"/>
                </div>
            </div>

            <p th:utext="${post.content}"></p>

            <div class="recommend-container">
                <p>Ï∂îÏ≤úÏàò: <span th:text="${post.recommendationCount}"></span></p>
                <button class="btn btn-sm btn-outline-primary"
                        th:data-url="@{/posts/{postId}/recommend (postId=${post.postId})}"
                        data-method="PUT"
                        onclick="setupAlertBox(this)">Ï∂îÏ≤ú
                </button>

                <button class="btn btn-sm btn-outline-primary"
                        th:data-url="@{/posts/{postId}/disrecommend (postId=${post.postId})}"
                        data-method="PUT"
                        onclick="setupAlertBox(this)">ÎπÑÏ∂îÏ≤ú
                </button>

                <button class="btn btn-sm btn-outline-primary"
                        th:data-url="@{/posts/{postId}/favorites (postId=${post.postId})}"
                        data-method="Post"
                        onclick="setupAlertBox(this)">‚ù§Ô∏è
                </button>

                <button class="btn btn-sm btn-outline-primary" id="reportButton"
                        th:data-url="@{/posts/{postId}/postReports (postId=${post.postId})}"
                        data-method="POST">
                    üö®
                </button>
                <div class="popup" id="reportPopup">
                    <p><strong>[Ïã†Í≥†Ïú†Ìòï]</strong></p>
                    <a data-report-type="Ï†ïÏπò" onclick="submitReport(this)">- Ï†ïÏπò</a>
                    <a data-report-type="ÏÑ±Ïù∏Î¨º" onclick="submitReport(this)">- ÏÑ±Ïù∏Î¨º</a>
                    <a data-report-type="Í∏∞ÌÉÄ" onclick="submitReport(this)">- Í∏∞ÌÉÄ</a>
                </div>

            </div>


            <hr style="width: 100%"/>

            <!-- Ï≤®Î∂ÄÌååÏùº -->
            <div th:if="${!post.images().isEmpty()}" class="image-gallery"
                 style="display: flex; flex-wrap: wrap; gap: 10px;">
                <p>Ï≤®Î∂ÄÌååÏùº</p>
                <div th:each="image : ${post.images}" class="image-container" style="position: relative;">
                    <!-- Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎ™Ö -->
                    <a th:href="${image.url}" th:text="${image.originalName}"></a>
                </div>
            </div>

            <div th:if="${post.isAuthorized}" style="display: flex; align-items: center;">
                <a th:href="@{/posts/{postId}/update (postId=${post.postId()})}"
                   class="btn btn-warning inline-text">ÏàòÏ†ï</a>
                <form th:action="@{/posts/{postId} (postId=${post.postId()})}" th:method="delete">
                    <button type="submit" class="btn btn-danger inline-text">ÏÇ≠Ï†ú</button>
                </form>
            </div>

            <hr style="width: 100%"/>

            <!-- ÎåìÍ∏Ä ÏÑπÏÖò -->
            <div class="comment-section">
                <h5>ÎåìÍ∏Ä</h5>
                <hr style="width: 100%"/>

                <!-- ÎåìÍ∏Ä Î¶¨Ïä§Ìä∏ -->
                <div th:if="${comment.parentCommentId == null}" th:each="comment : ${comments}">
                    <!-- Ïû¨Í∑Ä Ìò∏Ï∂ú ÏãúÏûë -->
                    <div th:fragment="commentTree">
                        <div class="comment-container" th:id="${comment.commentId}">
                            <div th:if="${!comment.isDeleted}">
                                <div>
                                    <img class="userGrade"
                                         th:src="@{/profile/{userGradeName}.png (userGradeName=${comment.userGradeName()})}"
                                         alt="ÌîÑÎ°úÌïÑ">
                                    <strong th:text="${comment.writer}"></strong>
                                    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
                                </div>
                                <div class="recommend-container">
                                    <button class="btn btn-sm btn-outline-primary"
                                            th:data-url="@{/posts/{postId}/comments/{commentId}/recommend (postId=${post.postId}, commentId=${comment.commentId})}"
                                            data-method="PUT"
                                            onclick="setupAlertBox(this)">Ï∂îÏ≤ú
                                    </button>
                                    <span th:text="${comment.recommendationCount}"></span>

                                    <button class="btn btn-sm btn-outline-primary"
                                            th:data-url="@{/posts/{postId}/comments/{commentId}/disrecommend (postId=${post.postId}, commentId=${comment.commentId})}"
                                            data-method="PUT"
                                            onclick="setupAlertBox(this)">ÎπÑÏ∂îÏ≤ú
                                    </button>
                                    <span th:text="${comment.decommendationCount}"></span>

                                    <!-- ÎåÄÎåìÍ∏Ä ÏûëÏÑ± Î≤ÑÌäº -->
                                    <button class="btn btn-sm btn-outline-primary">ÎåÄÎåìÍ∏Ä ÏûëÏÑ±</button>

                                    <div th:if="${comment.isAuthorized}" style="display: flex; align-items: center;">
                                        <button class="btn btn-warning inline-text">ÏàòÏ†ï</button>
                                        <form th:action="@{/posts/{postId}/comments/{commentId} (postId=${post.postId}, commentId=${comment.commentId})}"
                                              th:method="delete">
                                            <button type="submit" class="btn btn-danger inline-text">ÏÇ≠Ï†ú</button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <p th:utext="${comment.content}"></p>

                            <div class="sub-comment-form-container"
                                 th:data-post-id="${post.postId}"
                                 th:data-comment-id="${comment.commentId}"></div>
                        </div>

                        <hr style="width: 100%"/>

                        <!-- ÎåÄÎåìÍ∏Ä Ï∂úÎ†• -->
                        <div th:if="${comment.childComments != null && !comment.childComments.isEmpty()}"
                             style="margin-left: 20px;">
                            <!-- Ïû¨Í∑Ä Ìò∏Ï∂ú -->
                            <th:block th:each="childComment : ${comment.childComments}">
                                <th:block th:with="comment=${childComment}"
                                          th:insert="~{this :: commentTree}"
                                          th:remove="tag">
                                </th:block>
                            </th:block>
                        </div>
                    </div>
                </div>

                <!-- ÎåìÍ∏Ä ÏûëÏÑ± Ìèº -->
                <div class="comment-form-container" th:data-post-id="${post.postId}"></div>

            </div>

            <!--            &lt;!&ndash; Îã®Ïàú ÏïåÎ¶º Î∞ïÏä§ &ndash;&gt;-->
            <!--            <div id="alertBox" class="alert-box">-->
            <!--                <span id="alertMessage"></span>-->
            <!--            </div>-->
        </div>
    </div>
</div>

<footer th:insert="~{/common/footer}"></footer>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="/js/post/comment.js"></script>
<script src="/js/post/sub-comment.js"></script>
<script src="/js/post/remainingTime.js"></script>
<script src="/js/post/report.js"></script>

</body>
</html>
