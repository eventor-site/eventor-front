<link rel="stylesheet" type="text/css" media="screen" href="/css/postView/list.css"/>

<div>
    <div class="search-button" onclick="toggleSidebar('right-sidebar')">
        <i class="fa-solid fa-magnifying-glass"></i>
    </div>

    <div id="overlay" class="overlay" onclick="closeSidebarByOverlay()"></div>

    <aside class="sidebar sidebar-right" id="right-sidebar">
        <h3>검색</h3>

        <form class="search-form" th:action="@{/posts/search (categoryName=${categoryName})}" method="get">
            <input type="hidden" name="categoryName" th:value="${categoryName}">
            <input class="search-input" type="text" name="keyword" placeholder="검색어를 입력해주세요.">
            <button class="search-button" type="submit">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </form>

        <button id="close-sidebar" onclick="closeSidebar('right-sidebar')">×</button>

        <div class="sidebar-section">
            <div class="sidebar-section-title">인기 검색어</div>
            <div class="grid grid-2">

            </div>
        </div>

        <hr>

        <div class="sidebar-section">
            <div class="sidebar-section-title">최근 검색어</div>
            <div class="grid grid-2">

            </div>
        </div>

        <hr>

        <div class="sidebar-section">
            <div class="sidebar-section-title">최근 본 게시물</div>
            <div id="postViews" class="post-list"></div>
        </div>

        <hr>
    </aside>

</div>

<script>
    // 1. 사이드바 오른쪽 요소 가져오기
    const sidebarRight = document.querySelector('.sidebar-right');

    // 2. MutationObserver 정의
    const observer = new MutationObserver((mutationsList, observer) => {
        for (const mutation of mutationsList) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                if (sidebarRight.classList.contains('show')) {
                    // show 클래스가 추가되었으면 => 사이드바 열림
                    fetchRecentPosts();
                }
            }
        }
    });

    // 3. observer 시작 (class 속성 감시)
    observer.observe(sidebarRight, {attributes: true});


    // 최근 본 게시물 가져오기
    function fetchRecentPosts() {
        fetch('/users/me/postViews')
            .then(response => response.text())
            .then(html => {
                $('#postViews').replaceWith(html);
            })
            .catch(error => {
                console.error('최근 본 게시물 가져오기 실패:', error);
            });
    }


</script>
